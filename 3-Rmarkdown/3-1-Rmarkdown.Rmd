---
title: "R + Markdown"
subtitle: "It is about time..."
author: "R. Burke Squires"
date: "September 20, 2021"
output:
  xaringan::moon_reader:
    css: mckpam.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---


# Are You Ready To Learn About R + Markdown?

---

# R Markdown Overview

- R Markdown provides an authoring framework for data science

--

- You can use a single R Markdown file to both

  - Save and execute code

  - Generate high quality reports that can be shared

--

- R Markdown documents
  - Fully reproducible 
  - Support dozens of static and dynamic output formats

---

# What is possible with R Markdown

- Lets see what is possiblew with R Markdown [Gallery](https://rmarkdown.rstudio.com/gallery.html).

--

- I suggest you download (and print) the [R Markdown cheatsheet](cheatsheeets/rmarkdown-reference.pdf)

---

# R Markdown vs Notebook vs Script

|                 | R Markdown | R Notebook  |  R Script | 
|-----------------|------------|:-----------:|----------:|
| Extension       | .Rmd       | .Rmd        | .R        |
| Run R code?     | Yes        | Yes         | Yes       |
| Narrative Text? | Yes        | Yes         | No        |
| Format output?  | Yes        | No          | No        |


- *R Notebook vs R Markdown*
  - Same file format - the difference is how YOU work with it.

- When you want to extract all R code from an R Markdown document, you can call the function `knitr::purl()`

---

# Difference between R Markdown and RNotebooks

- R Markdown documents are ‘knitted’, while R Notebooks are ‘previewed’.

- Notebook preview does not execute any code chunks, 
  - Only shows a rendered copy of the Markdown output with most recent chunk output. 
  - Preview is generated automatically whenever the notebook is saved. 

- Note: R Markdown Notebooks are only available in RStudio 1.0 or higher.


---

#	How Do You Get R Markdown

**Installation**

- Like the rest of R, R Markdown is free and open source 
- You can install the R Markdown package from CRAN with:

  `install.packages("rmarkdown")`

---

#	How Does R Markdown Works?

![How it works](images/rmarkdownflow.png)

- When you run render, R Markdown feeds the .Rmd file to `knitr`, which executes all of the code chunks and creates a new markdown (.md) document which includes the code and its output.

- The markdown file generated by `knitr` is then processed by `pandoc` which is responsible for creating the finished format.

- In short, rmarkdown::render() = knitr::knit() + Pandoc (+ LaTeX for PDF output only).

- May sound complicated, but R Markdown makes it simple...a single render function.


---

# Note

- Not all R Markdown documents are eventually compiled through Pandoc. 

- The intermediate .md file could be compiled by other Markdown renderers. Below are two examples:

- **Xaringan** package passes the .md output to a JavaScript library, which renders the Markdown content in the web browser.

- **Blogdown** package supports the .Rmarkdown document format, which is knitted to .markdown, and this Markdown document is usually rendered to HTML by an external site generator.

---

# Workflow

An example R Markdown workflow:

1. Open a **new .Rmd file** in the RStudio IDE by going to ~File > New File > R Markdown~
2. **Embed code** in chunks. Run code by line, by chunk, or all at once.
3. **Write text** and add tables, figures, images, and citations. Format with Markdown syntax or the RStudio Visual Markdown Editor.
4. **Set output format(s) and options** in the YAML header. Customize themes or add parameters to execute or add interactivity with Shiny.
5. **Save and render** the whole document. Knit periodically to preview your work as you write. 6. **Share your work!**


---

# Anatomy of an R Markdown File

Open `RStudio` -> `File` -> `New file` -> `Rmarkdown` -> Click `OK`

Notice that the file contains three types of content:

- An (optional) YAML header surrounded by three dashes
- R code chunks surrounded by three backticks
- Text mixed with simple text formatting

---

# Anatomy of an R Markdown File

**Header (YAML)**

- Three dashes (to open)
- Title
- Author
- Date
- Output format(s)(Used for compiling - multiple output formats can be written here!)
- Three dashes (to close)

**Body Options**

- Code Chunks
- Inline Code
- Parameters
- Tables
- Markdown


---

# Code Chunks

- **Goal:**

  - add R code to the document,

- *along with its output*.

- Go ahead

- To add a *chunk* of R code, type what you see below...

````
```{r}`r ''`
2^(0:10)
```
````

or insert a chunk from the menu: `Code` -> `Insert Chunk`

---

# Code Chunks: Adding in R

**Try it!**

- Powers of two?

````
```{r}`r ''`
2^(0:10)
```
````

Powers of two?

```{r}
2^(0:10)
```

---

# Code Chunks: Adding in R

````
`r ''`
```{r, eval=FALSE}
cumsum( 4 * (-1)^(0:20) / (2*(0:20)+1) )
```
````
--

```{r}
cumsum( 4 * (-1)^(0:20) / (2*(0:20)+1) )
```

---

# Code Chunks: Adding in R

````
`r ''`
```{r, eval=FALSE}
plot(cumsum( 4 * (-1)^(0:20) / (2*(0:20)+1) ))
abline(h=pi, col='red')
```
````

--

```{r, fig.height=3.5}
plot(cumsum( 4 * (-1)^(0:20) / (2*(0:20)+1) ))
abline(h=pi, col='red')
```


---

#Code Chunks vs Inline Code

**Options are set like: ```{r this-chunk-name, my-options-go-here=TRUE/FALSE}**

Common Options:
- **eval**: TRUE/FALSE - Whether to evaluate a code chunk.
- **echo**: TRUE/FALSE - Whether to echo the source code in the output document
- **results**: hide/asis - Set to 'hide’ text or simply output code just as it is written
- **warning, message, error**: TRUE/FALSE - Whether to show warnings, messages, and errors in the output
- **include**: TRUE/FALSE - Whether to include anything from a code chunk in the output document.  NOTE: include=FALSE means echo = FALSE, results = 'hide', warning = FALSE, and message = FALSE
- **out.width** and **out.height**: “No.%” – Page with of plot output e.g., out.width = '80%' means 80% of width
- **fig.align**: left/center/right - The alignment of plots
- **dev**: pdf/png/svg - The device format to record plots, usually 'pdf' for LaTeX, 'png’ for HTML output
- **fig.cap**: string - The figure caption

See more here: https://bookdown.org/yihui/rmarkdown-cookbook/r-code.html

---

# Inline Code

- Code results can be inserted directly into the text of a .Rmd file by enclosing the code with `r `. The file below uses `r ` twice to call colorFunc, which returns “heat.colors.”

```{r include=TRUE}
colorfunc <- "heat.colors"
# colorfunc <- "terrain.colors"
```

Base R comes with many functions for generating colors. The code below demonstrates the `r colorfunc` function.

---

# Code Languages

- `knitr` can execute code in many languages besides R. 

- Some of the available language engines include:
  - Python
  - SQL
  - Bash
  - Rcpp
  - JavaScript
  - CSS

- To process a code chunk using an alternate language engine, replace the r at the start of your chunk declaration with the name of the language

```{bash}
pwd
```
- Note that chunk options like echo and results are all valid when using a language engine like python.

- Note, *except for python*, these sessions are closed at the end of each code chunk so variables do not persist throughout the document

https://bookdown.org/yihui/rmarkdown-cookbook/r-code.html

---

# Code Languages

**Lets list some parts of the cell!**

```{python python-chunk}
parts = ['nucleus','ribosome','plasma membrane','mitochondria','endoplasmic reticulum']
for p in parts:
    print(p)
```

---

# Code Languages

**Lets list some types of bacteria by genus!**

```{ruby ruby-chunk}
bacs = ['Micrococcus','Staphylococcus','Bacillus','Pseudomona']
bacs.each {|b| puts b}
```

---

# Parameters

Click [here](https://rstudio.cloud/project/181942) to open in RStudio.cloud

![parameters](images/params-1-hawaii.png){ width=75% height=75% }

---

# Parameters

R Markdown documents can include one or more parameters whose values can be set when you render the report. In the previous image, uses a data parameter that determines which data set to plot.

**Declaring Parameters**
Parameters are declared using the params field within the YAML header of the document. For example, the file above creates the parameter data and assigns it the default value "hawaii".

**Using Parameters in Code**
Parameters are made available within the knit environment as a read-only list named params. To access a parameter in code, call params$<parameter name>.

**Setting Parameters values**
Add a params argument to render to create a report that uses a new set of parameter values. Here we modify our report to use the aleutians data set with


---

# Tables

![Tables](images/tables-1-kable.png)

Check this out: https://www.tablesgenerator.com/markdown_tables

---

# Exercise / Challenge

The *NIEHS_NTP_SUBSTANCES.csv* data set from the National Toxicology Program has a list of known toxic substances that are studied at NIEHS.

*Challenge*: Your boss needs to set their budget next year to buy lab equipment and make supplier contracts. They ask you to create an HTML table with the following columns to include in their report: Substance Category, Substance Name, Analysis Method, and Supplier.

Try to make the nicest looking table you can!


---

# Lunch

## Questions?


---

# This presentation was adapted from these sources

- Peter Ralph, Univ. of Oregon, [R Markdown Tutorial](https://github.com/petrelharp/r-markdown-tutorial)
- RStudio's [R Markdown Introduction](https://rmarkdown.rstudio.com/lesson-1.html)
- Dan Veltri's [Introduction to R Markdown](https://bioinformatics.niaid.nih.gov/resources#10.4.4)

---

# Resources

*Cheatsheets*
- Look in the cheatsheets folder
  - [R Markdown cheatsheet](cheatsheeets/rmarkdown-reference.pdf)
  
*Books*
- [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
- [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/)
  - Advanced users can look here for new things to try.
- [R for Health Data Science](https://argoshare.is.ed.ac.uk/healthyr_book/the-anatomy-of-a-notebook-r-markdown-file.html)
- [Applied Statistics for Experimental Biology](https://www.middleprofessor.com/files/applied-biostatistics_bookdown/_book/)

*Other*
- [R Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)
- [Karl Broman's](http://kbroman.org/knitr_knutshell/pages/Rmarkdown.html) intro to R Markdown
- [Stack](http://stackoverflow.com/questions/tagged/rmarkdown)[Overflow](http://stackoverflow.com/questions/tagged/knitr)
- http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html

*Book Writing*
- [bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown/)

*Websites*
- [R Markdown website building tutorial](https://www.emilyzabor.com/tutorials/rmarkdown_websites_tutorial.html)
